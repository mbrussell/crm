## -------------------------------------------------------------------------------------------------------------------------------------
# 3. Bole biomass (DRYBIO_BOLE)
calc_DRYBIO_BOLE <- function(SPCD, VOLCFSND, WOOD_SPGR_GREENVOL_DRYWT, BARK_VOL_PCT,
                     BARK_SPGR_GREENVOL_DRYWT, DENS_RED, SLA_BOLE, SLA_BARK){
  DRYBIO_BOLEWOOD <- VOLCFSND*WOOD_SPGR_GREENVOL_DRYWT*62.4*DENS_RED*SLA_BOLE
  DRYBIO_BOLEBARK <- VOLCFSND*(BARK_VOL_PCT/100)*BARK_SPGR_GREENVOL_DRYWT*62.4*DENS_RED*SLA_BARK
  DRYBIO_BOLE <- DRYBIO_BOLEWOOD + DRYBIO_BOLEBARK 
  return(DRYBIO_BOLE)
  } 


## -------------------------------------------------------------------------------------------------------------------------------------
# 4. COMPONENT RATIO METHOD ADJUSTMENT FACTOR

calc_CRM_ADJ <- function(JENKINS_SPGRPCD, DRYBIO_BOLE, DBH){
  # Cedar/larch group (JENKINS_SPGRPCD = 1)
  if(JENKINS_SPGRPCD == 1){JENKINS_TOTAL_B1=-2.0336; JENKINS_TOTAL_B2=2.2592; JENKINS_STEM_WOOD_RATIO_B1=-0.3737; JENKINS_STEM_WOOD_RATIO_B2=-1.8055;
            JENKINS_STEM_BARK_RATIO_B1=-2.098; JENKINS_STEM_BARK_RATIO_B2=-1.6805; JENKINS_FOLIAGE_RATIO_B1=-2.9584; JENKINS_FOLIAGE_RATIO_B2=4.4766;
            JENKINS_ROOT_RATIO_B1=-1.5619; JENKINS_ROOT_RATIO_B2=0.6614;SAP_ADJUST=0.63086}
  # Douglas-fir group (JENKINS_SPGRPCD = 2)
  else if(JENKINS_SPGRPCD == 2){JENKINS_TOTAL_B1=-2.2304; JENKINS_TOTAL_B2=2.4435; JENKINS_STEM_WOOD_RATIO_B1=-0.3737; JENKINS_STEM_WOOD_RATIO_B2=-1.8055;
              JENKINS_STEM_BARK_RATIO_B1=-2.098; JENKINS_STEM_BARK_RATIO_B2=-1.6805; JENKINS_FOLIAGE_RATIO_B1=-2.9584; JENKINS_FOLIAGE_RATIO_B2=4.4766;
              JENKINS_ROOT_RATIO_B1=-1.5619; JENKINS_ROOT_RATIO_B2=0.6614;SAP_ADJUST=0.63086}
  # True fir/hemlock group (JENKINS_SPGRPCD = 3)
  else if(JENKINS_SPGRPCD == 3){JENKINS_TOTAL_B1=-2.5384; JENKINS_TOTAL_B2=2.4814;JENKINS_STEM_WOOD_RATIO_B1=-0.3737; JENKINS_STEM_WOOD_RATIO_B2=-1.8055;
                JENKINS_STEM_BARK_RATIO_B1=-2.098; JENKINS_STEM_BARK_RATIO_B2=-1.6805; JENKINS_FOLIAGE_RATIO_B1=-2.9584; JENKINS_FOLIAGE_RATIO_B2=4.4766;
                JENKINS_ROOT_RATIO_B1=-1.5619; JENKINS_ROOT_RATIO_B2=0.6614;SAP_ADJUST=0.45789}
  # Pine group (JENKINS_SPGRPCD = 4)
  else if(JENKINS_SPGRPCD == 4){JENKINS_TOTAL_B1=-2.5356; JENKINS_TOTAL_B2=2.4349;JENKINS_STEM_WOOD_RATIO_B1=-0.3737; JENKINS_STEM_WOOD_RATIO_B2=-1.8055;
        JENKINS_STEM_BARK_RATIO_B1=-2.098; JENKINS_STEM_BARK_RATIO_B2=-1.6805;JENKINS_FOLIAGE_RATIO_B1=-2.9584; JENKINS_FOLIAGE_RATIO_B2=4.4766;
        JENKINS_ROOT_RATIO_B1=-1.5619; JENKINS_ROOT_RATIO_B2=0.6614; SAP_ADJUST=0.43374}
  # Spruce group (JENKINS_SPGRPCD = 5)
  else if(JENKINS_SPGRPCD == 5){JENKINS_TOTAL_B1=-2.0773; JENKINS_TOTAL_B2=2.3323;JENKINS_STEM_WOOD_RATIO_B1=-0.3737; JENKINS_STEM_WOOD_RATIO_B2=-1.8055;
                JENKINS_STEM_BARK_RATIO_B1=-2.098; JENKINS_STEM_BARK_RATIO_B2=-1.6805;JENKINS_FOLIAGE_RATIO_B1=-2.9584; JENKINS_FOLIAGE_RATIO_B2=4.4766;
                JENKINS_ROOT_RATIO_B1=-1.5619; JENKINS_ROOT_RATIO_B2=0.6614; SAP_ADJUST=0.44215}
  # Aspen/alder/cottonwood/willow (JENKINS_SPGRPCD = 6)
  else if(JENKINS_SPGRPCD == 6){JENKINS_TOTAL_B1=-2.2094; JENKINS_TOTAL_B2=2.3867; JENKINS_STEM_WOOD_RATIO_B1=-0.3065; JENKINS_STEM_WOOD_RATIO_B2=-5.424;
                   JENKINS_STEM_BARK_RATIO_B1=-2.0129; JENKINS_STEM_BARK_RATIO_B2=-1.6805; JENKINS_FOLIAGE_RATIO_B1=-4.0813; JENKINS_FOLIAGE_RATIO_B2=5.8816;
                   JENKINS_ROOT_RATIO_B1=-1.6911; JENKINS_ROOT_RATIO_B2=0.816;SAP_ADJUST=0.37756}
  # Soft maple/birch  (JENKINS_SPGRPCD = 7) 
  else if(JENKINS_SPGRPCD == 7){JENKINS_TOTAL_B1=-1.9123; JENKINS_TOTAL_B2=2.3651; JENKINS_STEM_WOOD_RATIO_B1=-0.3065; JENKINS_STEM_WOOD_RATIO_B2=-5.424;
     JENKINS_STEM_BARK_RATIO_B1=-2.0129; JENKINS_STEM_BARK_RATIO_B2=-1.6805; JENKINS_FOLIAGE_RATIO_B1=-4.0813; JENKINS_FOLIAGE_RATIO_B2=5.8816;
     JENKINS_ROOT_RATIO_B1=-1.6911; JENKINS_ROOT_RATIO_B2=0.816;SAP_ADJUST=0.7443}
  # Mixed hardwood (JENKINS_SPGRPCD = 8)
  else if(JENKINS_SPGRPCD == 8){JENKINS_TOTAL_B1=-2.48; JENKINS_TOTAL_B2=2.4835; JENKINS_STEM_WOOD_RATIO_B1=-0.3065; JENKINS_STEM_WOOD_RATIO_B2=-5.424;
                            JENKINS_STEM_BARK_RATIO_B1=-2.0129; JENKINS_STEM_BARK_RATIO_B2=-1.6805; JENKINS_FOLIAGE_RATIO_B1=-4.0813; JENKINS_FOLIAGE_RATIO_B2=5.8816;
                            JENKINS_ROOT_RATIO_B1=-1.6911; JENKINS_ROOT_RATIO_B2=0.816;SAP_ADJUST=0.67171}
  # Hard maple/oak/hickory/beech (JENKINS_SPGRPCD = 9)
  else if(JENKINS_SPGRPCD == 9){JENKINS_TOTAL_B1=-2.0127; JENKINS_TOTAL_B2=2.4342; JENKINS_STEM_WOOD_RATIO_B1=-0.3065; JENKINS_STEM_WOOD_RATIO_B2=-5.424;
                JENKINS_STEM_BARK_RATIO_B1=-2.0129; JENKINS_STEM_BARK_RATIO_B2=-1.6805; JENKINS_FOLIAGE_RATIO_B1=-4.0813; JENKINS_FOLIAGE_RATIO_B2=5.8816;
                JENKINS_ROOT_RATIO_B1=-1.6911; JENKINS_ROOT_RATIO_B2=0.816;SAP_ADJUST=0.63243}
  # Juniper/oak/mesquite (JENKINS_SPGRPCD = 10)
  else if(JENKINS_SPGRPCD == 10){JENKINS_TOTAL_B1=-0.7152; JENKINS_TOTAL_B2=1.7029;JENKINS_STEM_WOOD_RATIO_B1=-0.3737; JENKINS_STEM_WOOD_RATIO_B2=-1.8055;
                JENKINS_STEM_BARK_RATIO_B1=-2.098; JENKINS_STEM_BARK_RATIO_B2=-1.1432;JENKINS_FOLIAGE_RATIO_B1=-2.9584; JENKINS_FOLIAGE_RATIO_B2=4.4766;
               JENKINS_ROOT_RATIO_B1=-1.5619;  JENKINS_ROOT_RATIO_B2=0.6614;SAP_ADJUST=0.35166}
  # Anything else set to 0
  else {JENKINS_TOTAL_B1=0; JENKINS_TOTAL_B2=0; JENKINS_STEM_WOOD_RATIO_B1=0; JENKINS_STEM_WOOD_RATIO_B2=0;
                   JENKINS_STEM_BARK_RATIO_B1=0; JENKINS_STEM_BARK_RATIO_B2=0; JENKINS_FOLIAGE_RATIO_B1=0; JENKINS_FOLIAGE_RATIO_B2=0;
                   JENKINS_ROOT_RATIO_B1=0; JENKINS_ROOT_RATIO_B2=0;SAP_ADJUST=0}
  
  BIO_ABOVE_JENKINS = (exp(JENKINS_TOTAL_B1+JENKINS_TOTAL_B2*log(DBH*2.54)))*2.20462 # total above-ground biomass (lbs) from Jenkins et al. 2004;
  BIO_BOLE_RATIO = exp(JENKINS_STEM_WOOD_RATIO_B1+(JENKINS_STEM_WOOD_RATIO_B2/(DBH*2.54)))
  BIO_BARK_RATIO = exp(JENKINS_STEM_BARK_RATIO_B1+(JENKINS_STEM_BARK_RATIO_B2/(DBH*2.54)))
  BIO_FOL_RATIO = exp(JENKINS_FOLIAGE_RATIO_B1+(JENKINS_FOLIAGE_RATIO_B2/(DBH*2.54)))
  MST = BIO_ABOVE_JENKINS*(BIO_BARK_RATIO+BIO_BOLE_RATIO) # merchantable oven-dry bole biomass (lbs) from Jenkins et al.  2004;
  FOL = BIO_ABOVE_JENKINS*(BIO_FOL_RATIO) # merchantable oven-dry bole biomass (lbs) from Jenkins et al.  2004;
  CRM_AF=ifelse(DBH >= 5.0, DRYBIO_BOLE/MST, 0) #component ratio method adjustment factor;     
  
  return(CRM_AF)
  }   


## -------------------------------------------------------------------------------------------------------------------------------------
# 5. STUMP VOLUME AND BIOMASS
calc_DRYBIO_STUMP <- function(SPCD, DBH, CRM_AF, RAILE_STUMP_DOB_B1, RAILE_STUMP_DIB_B1, RAILE_STUMP_DIB_B2,
                              WOOD_SPGR_GREENVOL_DRYWT, BARK_SPGR_GREENVOL_DRYWT, SLA_STUMP){
	STUMP_VOSB = (3.14159265*(DBH**2))/(4*144)*(((1-RAILE_STUMP_DOB_B1)**2*1+11*RAILE_STUMP_DOB_B1*
	                                               (1-RAILE_STUMP_DOB_B1)*log(1+1)-30.25/(1+1)*RAILE_STUMP_DOB_B1**2)
	                                            -((1-RAILE_STUMP_DOB_B1)**2*0+11*RAILE_STUMP_DOB_B1*(1-RAILE_STUMP_DOB_B1)*
	                                                log(0+1)-30.25/(0+1)*RAILE_STUMP_DOB_B1**2)) # stump volume outside bark
	STUMP_VISB = (3.14159265*(DBH**2))/(4*144)*(((RAILE_STUMP_DIB_B1-RAILE_STUMP_DIB_B2)**2*1+11*RAILE_STUMP_DIB_B2*
	                                               (RAILE_STUMP_DIB_B1-RAILE_STUMP_DIB_B2)*log(1+1)-30.25/(1+1)*RAILE_STUMP_DIB_B2**2)
	                                            -((RAILE_STUMP_DIB_B1-RAILE_STUMP_DIB_B2)**2*0+11*RAILE_STUMP_DIB_B2*
	                                                (RAILE_STUMP_DIB_B1-RAILE_STUMP_DIB_B2)*log(0+1)-30.25/(0+1)*RAILE_STUMP_DIB_B2**2)) # stump volume inside bark
	
	STUMP_ODSW = STUMP_VISB*WOOD_SPGR_GREENVOL_DRYWT*62.4 # stump wood biomass
	STUMP_ODSB = (STUMP_VOSB-STUMP_VISB)*BARK_SPGR_GREENVOL_DRYWT*62.4 # stump bark biomass
	DRYBIO_STUMP = (STUMP_ODSW+STUMP_ODSB)*CRM_AF*SLA_STUMP # total stump biomass
  return(DRYBIO_STUMP)
	} 


## -------------------------------------------------------------------------------------------------------------------------------------
# 6. TOP AND BRANCH BIOMASS

calc_TOP_BRANCH<- function(JENKINS_SPGRPCD, DBH, DRYBIO_STUMP, DRYBIO_BOLE, SLA_TOP){
  # Cedar/larch group (JENKINS_SPGRPCD = 1)
  if(JENKINS_SPGRPCD == 1){JENKINS_TOTAL_B1=-2.0336; JENKINS_TOTAL_B2=2.2592; JENKINS_STEM_WOOD_RATIO_B1=-0.3737; JENKINS_STEM_WOOD_RATIO_B2=-1.8055;
            JENKINS_STEM_BARK_RATIO_B1=-2.098; JENKINS_STEM_BARK_RATIO_B2=-1.6805; JENKINS_FOLIAGE_RATIO_B1=-2.9584; JENKINS_FOLIAGE_RATIO_B2=4.4766;
            JENKINS_ROOT_RATIO_B1=-1.5619; JENKINS_ROOT_RATIO_B2=0.6614;SAP_ADJUST=0.63086}
  # Douglas-fir group (JENKINS_SPGRPCD = 2)
  else if(JENKINS_SPGRPCD == 2){JENKINS_TOTAL_B1=-2.2304; JENKINS_TOTAL_B2=2.4435; JENKINS_STEM_WOOD_RATIO_B1=-0.3737; JENKINS_STEM_WOOD_RATIO_B2=-1.8055;
              JENKINS_STEM_BARK_RATIO_B1=-2.098; JENKINS_STEM_BARK_RATIO_B2=-1.6805; JENKINS_FOLIAGE_RATIO_B1=-2.9584; JENKINS_FOLIAGE_RATIO_B2=4.4766;
              JENKINS_ROOT_RATIO_B1=-1.5619; JENKINS_ROOT_RATIO_B2=0.6614;SAP_ADJUST=0.63086}
  # True fir/hemlock group (JENKINS_SPGRPCD = 3)
  else if(JENKINS_SPGRPCD == 3){JENKINS_TOTAL_B1=-2.5384; JENKINS_TOTAL_B2=2.4814;JENKINS_STEM_WOOD_RATIO_B1=-0.3737; JENKINS_STEM_WOOD_RATIO_B2=-1.8055;
                JENKINS_STEM_BARK_RATIO_B1=-2.098; JENKINS_STEM_BARK_RATIO_B2=-1.6805; JENKINS_FOLIAGE_RATIO_B1=-2.9584; JENKINS_FOLIAGE_RATIO_B2=4.4766;
                JENKINS_ROOT_RATIO_B1=-1.5619; JENKINS_ROOT_RATIO_B2=0.6614;SAP_ADJUST=0.45789}
  # Pine group (JENKINS_SPGRPCD = 4)
  else if(JENKINS_SPGRPCD == 4){JENKINS_TOTAL_B1=-2.5356; JENKINS_TOTAL_B2=2.4349;JENKINS_STEM_WOOD_RATIO_B1=-0.3737; JENKINS_STEM_WOOD_RATIO_B2=-1.8055;
        JENKINS_STEM_BARK_RATIO_B1=-2.098; JENKINS_STEM_BARK_RATIO_B2=-1.6805;JENKINS_FOLIAGE_RATIO_B1=-2.9584; JENKINS_FOLIAGE_RATIO_B2=4.4766;
        JENKINS_ROOT_RATIO_B1=-1.5619; JENKINS_ROOT_RATIO_B2=0.6614; SAP_ADJUST=0.43374}
  # Spruce group (JENKINS_SPGRPCD = 5)
  else if(JENKINS_SPGRPCD == 5){JENKINS_TOTAL_B1=-2.0773; JENKINS_TOTAL_B2=2.3323;JENKINS_STEM_WOOD_RATIO_B1=-0.3737; JENKINS_STEM_WOOD_RATIO_B2=-1.8055;
                JENKINS_STEM_BARK_RATIO_B1=-2.098; JENKINS_STEM_BARK_RATIO_B2=-1.6805;JENKINS_FOLIAGE_RATIO_B1=-2.9584; JENKINS_FOLIAGE_RATIO_B2=4.4766;
                JENKINS_ROOT_RATIO_B1=-1.5619; JENKINS_ROOT_RATIO_B2=0.6614; SAP_ADJUST=0.44215}
  # Aspen/alder/cottonwood/willow (JENKINS_SPGRPCD = 6)
  else if(JENKINS_SPGRPCD == 6){JENKINS_TOTAL_B1=-2.2094; JENKINS_TOTAL_B2=2.3867; JENKINS_STEM_WOOD_RATIO_B1=-0.3065; JENKINS_STEM_WOOD_RATIO_B2=-5.424;
                   JENKINS_STEM_BARK_RATIO_B1=-2.0129; JENKINS_STEM_BARK_RATIO_B2=-1.6805; JENKINS_FOLIAGE_RATIO_B1=-4.0813; JENKINS_FOLIAGE_RATIO_B2=5.8816;
                   JENKINS_ROOT_RATIO_B1=-1.6911; JENKINS_ROOT_RATIO_B2=0.816;SAP_ADJUST=0.37756}
  # Soft maple/birch  (JENKINS_SPGRPCD = 7) 
  else if(JENKINS_SPGRPCD == 7){JENKINS_TOTAL_B1=-1.9123; JENKINS_TOTAL_B2=2.3651; JENKINS_STEM_WOOD_RATIO_B1=-0.3065; JENKINS_STEM_WOOD_RATIO_B2=-5.424;
     JENKINS_STEM_BARK_RATIO_B1=-2.0129; JENKINS_STEM_BARK_RATIO_B2=-1.6805; JENKINS_FOLIAGE_RATIO_B1=-4.0813; JENKINS_FOLIAGE_RATIO_B2=5.8816;
     JENKINS_ROOT_RATIO_B1=-1.6911; JENKINS_ROOT_RATIO_B2=0.816;SAP_ADJUST=0.7443}
  # Mixed hardwood (JENKINS_SPGRPCD = 8)
  else if(JENKINS_SPGRPCD == 8){JENKINS_TOTAL_B1=-2.48; JENKINS_TOTAL_B2=2.4835; JENKINS_STEM_WOOD_RATIO_B1=-0.3065; JENKINS_STEM_WOOD_RATIO_B2=-5.424;
                            JENKINS_STEM_BARK_RATIO_B1=-2.0129; JENKINS_STEM_BARK_RATIO_B2=-1.6805; JENKINS_FOLIAGE_RATIO_B1=-4.0813; JENKINS_FOLIAGE_RATIO_B2=5.8816;
                            JENKINS_ROOT_RATIO_B1=-1.6911; JENKINS_ROOT_RATIO_B2=0.816;SAP_ADJUST=0.67171}
  # Hard maple/oak/hickory/beech (JENKINS_SPGRPCD = 9)
  else if(JENKINS_SPGRPCD == 9){JENKINS_TOTAL_B1=-2.0127; JENKINS_TOTAL_B2=2.4342; JENKINS_STEM_WOOD_RATIO_B1=-0.3065; JENKINS_STEM_WOOD_RATIO_B2=-5.424;
                JENKINS_STEM_BARK_RATIO_B1=-2.0129; JENKINS_STEM_BARK_RATIO_B2=-1.6805; JENKINS_FOLIAGE_RATIO_B1=-4.0813; JENKINS_FOLIAGE_RATIO_B2=5.8816;
                JENKINS_ROOT_RATIO_B1=-1.6911; JENKINS_ROOT_RATIO_B2=0.816;SAP_ADJUST=0.63243}
  # Juniper/oak/mesquite (JENKINS_SPGRPCD = 10)
  else if(JENKINS_SPGRPCD == 10){JENKINS_TOTAL_B1=-0.7152; JENKINS_TOTAL_B2=1.7029;JENKINS_STEM_WOOD_RATIO_B1=-0.3737; JENKINS_STEM_WOOD_RATIO_B2=-1.8055;
                JENKINS_STEM_BARK_RATIO_B1=-2.098; JENKINS_STEM_BARK_RATIO_B2=-1.1432;JENKINS_FOLIAGE_RATIO_B1=-2.9584; JENKINS_FOLIAGE_RATIO_B2=4.4766;
               JENKINS_ROOT_RATIO_B1=-1.5619;  JENKINS_ROOT_RATIO_B2=0.6614;SAP_ADJUST=0.35166}
  # Anything else set to 0
  else {JENKINS_TOTAL_B1=0; JENKINS_TOTAL_B2=0; JENKINS_STEM_WOOD_RATIO_B1=0; JENKINS_STEM_WOOD_RATIO_B2=0;
                   JENKINS_STEM_BARK_RATIO_B1=0; JENKINS_STEM_BARK_RATIO_B2=0; JENKINS_FOLIAGE_RATIO_B1=0; JENKINS_FOLIAGE_RATIO_B2=0;
                   JENKINS_ROOT_RATIO_B1=0; JENKINS_ROOT_RATIO_B2=0;SAP_ADJUST=0}
  
	BIO_ABOVE_JENKINS = (exp(JENKINS_TOTAL_B1+JENKINS_TOTAL_B2*log(DBH*2.54)))*2.20462 # total above-ground biomass (lbs) from Jenkins et al. 2003;
  BIO_BOLE_RATIO = exp(JENKINS_STEM_WOOD_RATIO_B1+(JENKINS_STEM_WOOD_RATIO_B2/(DBH*2.54)))
	BIO_BARK_RATIO = exp(JENKINS_STEM_BARK_RATIO_B1+(JENKINS_STEM_BARK_RATIO_B2/(DBH*2.54)))
	BIO_FOL_RATIO = exp(JENKINS_FOLIAGE_RATIO_B1+(JENKINS_FOLIAGE_RATIO_B2/(DBH*2.54)))
	MST = BIO_ABOVE_JENKINS*(BIO_BARK_RATIO+BIO_BOLE_RATIO) # merchantable oven-dry bole biomass (lbs) from Jenkins et al.  2004;
	FOL = BIO_ABOVE_JENKINS*(BIO_FOL_RATIO); # merchantable oven-dry bole biomass (lbs) from Jenkins et al.  2004;
	CRM_AF = DRYBIO_BOLE/MST # component ratio method adjustment factor;     
  DRYBIO_TOP = ifelse(DBH >= 5.0, (BIO_ABOVE_JENKINS-MST-(DRYBIO_STUMP/CRM_AF)-FOL)*CRM_AF*SLA_TOP, 0) # top and branch biomass;
  return(DRYBIO_TOP)
  }   


## -------------------------------------------------------------------------------------------------------------------------------------
# 7. Total aboveground biomass

calc_BIOMASS <- function(DBH, JENKINS_SPGRPCD, DRYBIO_BOLE, DRYBIO_STUMP, DRYBIO_TOP, WOODLAND,
                         DENS_RED, SLA_TOP, SLA_BOLE, SLA_BARK){
   # Cedar/larch group (JENKINS_SPGRPCD = 1)
  if(JENKINS_SPGRPCD == 1){JENKINS_TOTAL_B1=-2.0336; JENKINS_TOTAL_B2=2.2592; JENKINS_STEM_WOOD_RATIO_B1=-0.3737; JENKINS_STEM_WOOD_RATIO_B2=-1.8055;
            JENKINS_STEM_BARK_RATIO_B1=-2.098; JENKINS_STEM_BARK_RATIO_B2=-1.6805; JENKINS_FOLIAGE_RATIO_B1=-2.9584; JENKINS_FOLIAGE_RATIO_B2=4.4766;
            JENKINS_ROOT_RATIO_B1=-1.5619; JENKINS_ROOT_RATIO_B2=0.6614;SAP_ADJUST=0.63086}
  # Douglas-fir group (JENKINS_SPGRPCD = 2)
  else if(JENKINS_SPGRPCD == 2){JENKINS_TOTAL_B1=-2.2304; JENKINS_TOTAL_B2=2.4435; JENKINS_STEM_WOOD_RATIO_B1=-0.3737; JENKINS_STEM_WOOD_RATIO_B2=-1.8055;
              JENKINS_STEM_BARK_RATIO_B1=-2.098; JENKINS_STEM_BARK_RATIO_B2=-1.6805; JENKINS_FOLIAGE_RATIO_B1=-2.9584; JENKINS_FOLIAGE_RATIO_B2=4.4766;
              JENKINS_ROOT_RATIO_B1=-1.5619; JENKINS_ROOT_RATIO_B2=0.6614;SAP_ADJUST=0.63086}
  # True fir/hemlock group (JENKINS_SPGRPCD = 3)
  else if(JENKINS_SPGRPCD == 3){JENKINS_TOTAL_B1=-2.5384; JENKINS_TOTAL_B2=2.4814;JENKINS_STEM_WOOD_RATIO_B1=-0.3737; JENKINS_STEM_WOOD_RATIO_B2=-1.8055;
                JENKINS_STEM_BARK_RATIO_B1=-2.098; JENKINS_STEM_BARK_RATIO_B2=-1.6805; JENKINS_FOLIAGE_RATIO_B1=-2.9584; JENKINS_FOLIAGE_RATIO_B2=4.4766;
                JENKINS_ROOT_RATIO_B1=-1.5619; JENKINS_ROOT_RATIO_B2=0.6614;SAP_ADJUST=0.45789}
  # Pine group (JENKINS_SPGRPCD = 4)
  else if(JENKINS_SPGRPCD == 4){JENKINS_TOTAL_B1=-2.5356; JENKINS_TOTAL_B2=2.4349;JENKINS_STEM_WOOD_RATIO_B1=-0.3737; JENKINS_STEM_WOOD_RATIO_B2=-1.8055;
        JENKINS_STEM_BARK_RATIO_B1=-2.098; JENKINS_STEM_BARK_RATIO_B2=-1.6805;JENKINS_FOLIAGE_RATIO_B1=-2.9584; JENKINS_FOLIAGE_RATIO_B2=4.4766;
        JENKINS_ROOT_RATIO_B1=-1.5619; JENKINS_ROOT_RATIO_B2=0.6614; SAP_ADJUST=0.43374}
  # Spruce group (JENKINS_SPGRPCD = 5)
  else if(JENKINS_SPGRPCD == 5){JENKINS_TOTAL_B1=-2.0773; JENKINS_TOTAL_B2=2.3323;JENKINS_STEM_WOOD_RATIO_B1=-0.3737; JENKINS_STEM_WOOD_RATIO_B2=-1.8055;
                JENKINS_STEM_BARK_RATIO_B1=-2.098; JENKINS_STEM_BARK_RATIO_B2=-1.6805;JENKINS_FOLIAGE_RATIO_B1=-2.9584; JENKINS_FOLIAGE_RATIO_B2=4.4766;
                JENKINS_ROOT_RATIO_B1=-1.5619; JENKINS_ROOT_RATIO_B2=0.6614; SAP_ADJUST=0.44215}
  # Aspen/alder/cottonwood/willow (JENKINS_SPGRPCD = 6)
  else if(JENKINS_SPGRPCD == 6){JENKINS_TOTAL_B1=-2.2094; JENKINS_TOTAL_B2=2.3867; JENKINS_STEM_WOOD_RATIO_B1=-0.3065; JENKINS_STEM_WOOD_RATIO_B2=-5.424;
                   JENKINS_STEM_BARK_RATIO_B1=-2.0129; JENKINS_STEM_BARK_RATIO_B2=-1.6805; JENKINS_FOLIAGE_RATIO_B1=-4.0813; JENKINS_FOLIAGE_RATIO_B2=5.8816;
                   JENKINS_ROOT_RATIO_B1=-1.6911; JENKINS_ROOT_RATIO_B2=0.816;SAP_ADJUST=0.37756}
  # Soft maple/birch  (JENKINS_SPGRPCD = 7) 
  else if(JENKINS_SPGRPCD == 7){JENKINS_TOTAL_B1=-1.9123; JENKINS_TOTAL_B2=2.3651; JENKINS_STEM_WOOD_RATIO_B1=-0.3065; JENKINS_STEM_WOOD_RATIO_B2=-5.424;
     JENKINS_STEM_BARK_RATIO_B1=-2.0129; JENKINS_STEM_BARK_RATIO_B2=-1.6805; JENKINS_FOLIAGE_RATIO_B1=-4.0813; JENKINS_FOLIAGE_RATIO_B2=5.8816;
     JENKINS_ROOT_RATIO_B1=-1.6911; JENKINS_ROOT_RATIO_B2=0.816;SAP_ADJUST=0.7443}
  # Mixed hardwood (JENKINS_SPGRPCD = 8)
  else if(JENKINS_SPGRPCD == 8){JENKINS_TOTAL_B1=-2.48; JENKINS_TOTAL_B2=2.4835; JENKINS_STEM_WOOD_RATIO_B1=-0.3065; JENKINS_STEM_WOOD_RATIO_B2=-5.424;
                            JENKINS_STEM_BARK_RATIO_B1=-2.0129; JENKINS_STEM_BARK_RATIO_B2=-1.6805; JENKINS_FOLIAGE_RATIO_B1=-4.0813; JENKINS_FOLIAGE_RATIO_B2=5.8816;
                            JENKINS_ROOT_RATIO_B1=-1.6911; JENKINS_ROOT_RATIO_B2=0.816;SAP_ADJUST=0.67171}
  # Hard maple/oak/hickory/beech (JENKINS_SPGRPCD = 9)
  else if(JENKINS_SPGRPCD == 9){JENKINS_TOTAL_B1=-2.0127; JENKINS_TOTAL_B2=2.4342; JENKINS_STEM_WOOD_RATIO_B1=-0.3065; JENKINS_STEM_WOOD_RATIO_B2=-5.424;
                JENKINS_STEM_BARK_RATIO_B1=-2.0129; JENKINS_STEM_BARK_RATIO_B2=-1.6805; JENKINS_FOLIAGE_RATIO_B1=-4.0813; JENKINS_FOLIAGE_RATIO_B2=5.8816;
                JENKINS_ROOT_RATIO_B1=-1.6911; JENKINS_ROOT_RATIO_B2=0.816;SAP_ADJUST=0.63243}
  # Juniper/oak/mesquite (JENKINS_SPGRPCD = 10)
  else if(JENKINS_SPGRPCD == 10){JENKINS_TOTAL_B1=-0.7152; JENKINS_TOTAL_B2=1.7029;JENKINS_STEM_WOOD_RATIO_B1=-0.3737; JENKINS_STEM_WOOD_RATIO_B2=-1.8055;
                JENKINS_STEM_BARK_RATIO_B1=-2.098; JENKINS_STEM_BARK_RATIO_B2=-1.1432;JENKINS_FOLIAGE_RATIO_B1=-2.9584; JENKINS_FOLIAGE_RATIO_B2=4.4766;
               JENKINS_ROOT_RATIO_B1=-1.5619;  JENKINS_ROOT_RATIO_B2=0.6614;SAP_ADJUST=0.35166}
  # Anything else set to 0
  else {JENKINS_TOTAL_B1=0; JENKINS_TOTAL_B2=0; JENKINS_STEM_WOOD_RATIO_B1=0; JENKINS_STEM_WOOD_RATIO_B2=0;
                   JENKINS_STEM_BARK_RATIO_B1=0; JENKINS_STEM_BARK_RATIO_B2=0; JENKINS_FOLIAGE_RATIO_B1=0; JENKINS_FOLIAGE_RATIO_B2=0;
                   JENKINS_ROOT_RATIO_B1=0; JENKINS_ROOT_RATIO_B2=0;SAP_ADJUST=0}
  
	BIO_ABOVE_JENKINS = (exp(JENKINS_TOTAL_B1+JENKINS_TOTAL_B2*log(DBH*2.54)))*2.20462 # total above-ground biomass (lbs) from Jenkins et al. 2003;
  BIO_BOLE_RATIO = exp(JENKINS_STEM_WOOD_RATIO_B1+(JENKINS_STEM_WOOD_RATIO_B2/(DBH*2.54)))
	BIO_BARK_RATIO = exp(JENKINS_STEM_BARK_RATIO_B1+(JENKINS_STEM_BARK_RATIO_B2/(DBH*2.54)))
	BIO_FOL_RATIO = exp(JENKINS_FOLIAGE_RATIO_B1+(JENKINS_FOLIAGE_RATIO_B2/(DBH*2.54)))
	FOL = BIO_ABOVE_JENKINS*(BIO_FOL_RATIO); # merchantable oven-dry bole biomass (lbs) from Jenkins et al.  2004;
  
    BIOMASS = ifelse(DBH >= 5.0, DRYBIO_BOLE + DRYBIO_STUMP + DRYBIO_TOP, ((BIO_ABOVE_JENKINS-FOL)*SAP_ADJUST*
                                                                             DENS_RED*(weighted.mean(c(SLA_BARK, SLA_TOP, SLA_BOLE), 
                                                                                            c(10, 20, 70)))))
  return(BIOMASS)
  } 


## -------------------------------------------------------------------------------------------------------------------------------------
# 8. Total aboveground carbon
calc_CARBON <- function(BIOMASS){
  CARBON = BIOMASS * 0.5
  return(CARBON)
  } 

